<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.w3.org/1999/xhtml">


<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>

<script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=hmecoefot7"></script>


<style>

    .myPage-wrapper{
        display: flex;

    }


    .myPage-header{
        flex: 30%;
        background-color: lightblue;
        display: flex;
        flex-direction: column;
        align-items: center;
        /*border-bottom: 2px solid;*/
    }


    .meyPage-header-myName{
        background-color: #9ec0dc;
        width: 78%;
        display: flex;
        align-self: center;
        align-items: center;
        height: 130px;
        margin-bottom: 36px;
    }

    .myPage-header-imgDiv{
        width: 75px;
        margin-left: 15px;
    }

    .myPage-header-imgDiv img{
        width: 100%;
    }

    .myPage-header-imgDiv span{
        margin-left: 10px;
    }

    .myPage-header-category{
        display: flex;
        flex-direction: column;
        row-gap-gap: 14px;
        font-size: 1.4em;
        justify-content: center;
    }

    .myPage-header-category div{
        background-color: white;
        padding: 6px;
        border-radius: 4px 4px 0 0;
    }

    .myPage-content{
        flex: 70%;
    }

    .data-box{
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        margin-bottom: 10px;
        border-bottom: 1px solid lightblue;
    }

    .data-title{
        margin-left: 20px;
    }

    .data-date{
        margin-right: 20px;
    }
</style>


<body>
<th:block th:replace="~{/layout/basic :: setContent(~{this :: content} )}">
    <th:block th:fragment="content">

    <div class="container">

        <div class="myPage-wrapper">
            <div class="myPage-header">

                <div class="meyPage-header-myName">
                    <div class="myPage-header-imgDiv">
                        <img src="/icon/person-circle.svg">
                    </div>
                    <span>
                        <h3>[[${dto.memberName}]]</h3>
                    </span>
                </div>
                <div class="col-md-12 myPage-header-category">
                    <div class="modify-myInfo-btn">내 정보 변경</div>
                    <div class="my-writings-btn">작성한 게시글</div>
                    <div class="my-replies-btn">작성한 댓글</div>
                </div>
            </div>

            <div class="myPage-content">
                <h1>마이 페이지</h1>

                <div class="content-wrapper">
                    <div class="load-content">

                    </div>
                </div>
            </div>
        </div>
    </div> <!-- container end -->

 <script th:inline="javascript">

    $(document).ready(function (){

        var email = [[${#authentication.principal.username}]];
        console.log(email);

        function formatTime(times){

            var date = new Date();

            return date.getFullYear() + '/' +
                (date.getMonth() +1) +  '/' +
                date.getDate() + ' ' +
                date.getHours() + ":" +
                date.getMinutes();
        }

        var loadContent = $(".load-content");

        // 작성한 게시글 클릭시 리스트 불러오는 이벤트
        $(".my-writings-btn").on("click", function (e){
            getBoardList(email);
        })

        // 작성한 댓글 클릭시 리스트 불러오는 이벤트
        $(".my-replies-btn").on("click", function (e){
            getRepliesList(email);
        })

        function getBoardList(email){

            var str = "";

            $.getJSON('/member/board/' + email, function (arr){

                console.log(arr);

                $(arr).each(function (i, dto){

                    console.info(dto)
                    console.info(dto.title)

                    var regDate =

                    str += '<div class="data-box">';
                    str += '<div class="data-title" data-bno="'+dto.bno+'"><a href="/board/read?bno='+dto.bno+'" target="_blank">'+dto.title+'</a></div>';
                    str += '<div class="data-date">'+formatTime(dto.regDate)+'</div>';
                    str += '</div>';
                })

                loadContent.html(str);

            })
        }

        function getRepliesList(email){

            var str = "";

            $.getJSON('/member/replies/' + email, function (arr){

                console.log(arr);

                $(arr).each(function (i, dto){

                    console.info(dto)
                    console.info(dto.title)

                    var regDate =

                        str += '<div class="data-box">';
                    str += '<div class="data-title" data-rno="'+dto.rno+'"><a href="/board/read?bno='+dto.bno+'" target="_blank">'+dto.text+'</a></div>';
                    str += '<div class="data-date">'+formatTime(dto.regDate)+'</div>';
                    str += '</div>';
                })

                loadContent.html(str);

            })
        }



    }) // the end

 </script>

    </th:block>
</th:block>
</body>
</html>